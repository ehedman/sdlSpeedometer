#!/bin/bash

# Start a single session weston(xwayland) -or an openvt bound application

PATH=$PATH:$(pwd)
export PATH

program=$1

app=$(which "${program}")

if [ -z "${app}" ]; then
    exit 1
fi

function doQuit() {

    if [ -n "${APPID}" ]; then
        kill -INT "${APPID}" &>/dev/null
    fi

    exit 0
}

trap doQuit EXIT

if [ "$(basename "${app}")" == "openvt" ]; then
    shift
    unset DISPLAY
    sudo -E openvt -c 3 -f -w -s "$@"
    exit 0
fi

shift


function  startChild()
{
    exec /usr/bin/dbus-run-session ${app} "$@" &>/dev/null
}

startChild "$@" &
APPID=$!
wait $APPID

doQuit
